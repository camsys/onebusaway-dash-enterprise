<VirtualHost *:80>
    ServerAdmin ops@example.com
    JkMount /* ajp13_worker
    JkUnMount /robots.txt ajp13_worker
    JkUnMount /release.html ajp13_worker
        DocumentRoot /var/www/
        <Directory />
                Options FollowSymLinks
                AllowOverride None
        </Directory>
        <Directory /var/www/>
                Options Indexes FollowSymLinks MultiViews
                AllowOverride None
                Require all granted 
                # This directive allows us to have apache2's default start page
                # in /apache2-default/, but still have / go to the right place
                #RedirectMatch ^/$ /apache2-default/
        </Directory>

        ErrorLog /var/log/apache2/error.log 

        # Possible values include: debug, info, notice, warn, error, crit,
        # alert, emerg.
        LogLevel warn

        CustomLog /var/log/apache2/access.log combined
        ServerSignature On

        Alias /doc/ "/usr/share/doc/"
        <Directory "/usr/share/doc/">
            Options Indexes MultiViews FollowSymLinks
            AllowOverride None
            Require host 127.0.0.0/255.0.0.0 ::1/128
        </Directory>

    # https for login page
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    # this statemet only evaluate if RewriteCond evals to true
    RewriteRule ^/login.action(.*) https://%{SERVER_NAME}/login.action$1 [R,L]

    # match the index page
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/$ https://%{SERVER_NAME}/ [R,L]

    # catch anything that goes to /admin
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/admin/(.*) https://%{SERVER_NAME}/admin/$1 [R,L]

    # catch anything that goes to reports and isn't https
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/transitime(.*) https://%{SERVER_NAME}/transitime$1 [R,L]

    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule "^/web/reports/(.+)" "https://%{SERVER_NAME}/transitime?_path=web/reports/$1" [PT,QSA]

    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule "^/web/(.+)" "https://%{SERVER_NAME}/transitime?_path=web/$1" [PT,QSA]

    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule "^/api/v1/(.+)" "https://%{SERVER_NAME}/transitime?_path=api/v1/$1" [R,QSA]

    RewriteEngine on
    # if we got here we are https already
    RewriteRule "^/web/reports/(.+)" "/transitime?_path=web/reports/$1" [PT,QSA]
    RewriteRule "^/web/(.+)" "/transitime?_path=web/$1" [PT,QSA]
    # redirect must specify https
    RewriteRule "^/api/v1/(.+)" "https://%{SERVER_NAME}/transitime?_path=api/v1/$1" [R,QSA]


</VirtualHost>
