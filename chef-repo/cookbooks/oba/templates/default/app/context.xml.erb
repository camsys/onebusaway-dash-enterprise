<?xml version='1.0' encoding='utf-8'?>
<Context>
    <WatchedResource>WEB-INF/web.xml</WatchedResource>

    <!-- database configuration moved to server.xml -->
<Resource name="jdbc/appDB"
          auth="Container"
          type="javax.sql.DataSource"
          factory="org.apache.tomcat.jdbc.pool.DataSourceFactory"
          testWhileIdle="true"
          testOnBorrow="true"
          testOnReturn="false"
          validationQuery="SELECT 1"
          validationInterval="30000"
          timeBetweenEvictionRunsMillis="30000"
          maxActive="100"
          minIdle="2"
          maxWait="10000"
          initialSize="2"
          removeAbandonedTimeout="300"
          removeAbandoned="true"
          logAbandoned="true"
          minEvictableIdleTimeMillis="300000"
          jmxEnabled="true"
          jdbcInterceptors="org.apache.tomcat.jdbc.pool.interceptor.ConnectionState;
            org.apache.tomcat.jdbc.pool.interceptor.StatementFinalizer"
          username="<%= node[:oba][:db_user] %>"
          password="<%= node[:oba][:db_password] %>"
          driverClassName="com.mysql.jdbc.Driver"
          url="jdbc:mysql://<%= node[:oba][:db_master] %>/<%= node[:oba][:db_instance_name] %>?rewriteBatchedStatements=true&amp;cachePrepStmts=true" />

    <Resource name="jdbc/agencyMetadataDB"
          auth="Container"
          type="javax.sql.DataSource"
          factory="org.apache.tomcat.jdbc.pool.DataSourceFactory"
          testWhileIdle="true"
          testOnBorrow="true"
          testOnReturn="false"
          validationQuery="SELECT 1"
          validationInterval="30000"
          timeBetweenEvictionRunsMillis="30000"
          maxActive="100"
          minIdle="2"
          maxWait="10000"
          initialSize="2"
          removeAbandonedTimeout="300"
          removeAbandoned="true"
          logAbandoned="true"
          minEvictableIdleTimeMillis="300000"
          jmxEnabled="true"
          jdbcInterceptors="org.apache.tomcat.jdbc.pool.interceptor.ConnectionState;
            org.apache.tomcat.jdbc.pool.interceptor.StatementFinalizer"      username="<%= node[:oba][:db_user] %>"
      password="<%= node[:oba][:db_password] %>"
      driverClassName="com.mysql.jdbc.Driver"
      url="jdbc:mysql://<%= node[:oba][:db_master] %>/<%= node[:oba][:db_archive] %>" >
    </Resource>

    <Environment name="xwikiUrl" value="http://xwiki.prod.wmata.obaweb.org:8080/xwiki" type="java.lang.String" override="true" />
    <Environment name="wikiDocumentEditUrl" value="http://xwiki.prod.wmata.obaweb.org:8080/xwiki/bin/edit/%{namespace}/%{documentName}" type="java.lang.String" override="true" />
    <Environment name="wikiAttachmentUrl" value="http://xwiki.prod.wmata.obaweb.org:8080/xwiki/bin/download/%{namespace}/%{documentName}/%{attachmentName}" type="java.lang.String" override="true" />
    <Parameter name="obanyc.resource" value="onebusaway-wmata" override="false" />

</Context>
