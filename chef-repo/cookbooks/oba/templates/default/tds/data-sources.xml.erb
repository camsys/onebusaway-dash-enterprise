<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd">

    <bean id="dataSource"
          class="org.springframework.jndi.JndiObjectFactoryBean">
      <property name="jndiName"
                value="java:comp/env/jdbc/appDB"/>
      <property name="lookupOnStartup"
                value="true"/>
      <property name="cache"
                value="true"/>
      <property name="proxyInterface"
                value="javax.sql.DataSource"/>
      <property name="resourceRef"
                value="true" />
    </bean>

    <bean class="org.onebusaway.container.spring.SystemPropertyOverrideConfigurer">
      <property name="order" value="-2" />
      <property name="properties">
          <props>
              <prop key="bundlePath"><%= node[:oba][:tds][:bundle_path] %></prop>
         </props>
      </property>
    </bean>

    <bean class="org.onebusaway.container.spring.PropertyOverrideConfigurer">
        <property name="properties">
            <props>
                <prop key="blockLocationServiceImpl.persistBlockLocationRecords">false</prop>
                <prop key="blockLocationServiceImpl.locationInterpolation">false</prop>
                <prop key="blockStatusServiceImpl.runningLateWindow">3600</prop>
            </props>
        </property>
    </bean>

    <bean class="org.onebusaway.transit_data_federation.impl.realtime.gtfs_realtime.GtfsRealtimeSource">
        <property name="tripUpdatesUrl" value="http://gtfsrt.<%= node[:oba][:env] %>.wmata.obaweb.org:8080/api/v1/key/<%= node[:transitime][:api_key] %>/agency/1/command/gtfs-rt/tripUpdates" />
        <property name="vehiclePositionsUrl" value="http://gtfsrt.<%= node[:oba][:env] %>.wmata.obaweb.org:8080/api/v1/key/<%= node[:transitime][:api_key] %>/agency/1/command/gtfs-rt/vehiclePositions" />
        <property name="refreshInterval" value="60" />
        <property name="agencyIds">
            <list>
                <value>1</value>
            </list>
        </property>
        <property name="showNegativeScheduledArrivals" value="false"/>
    </bean>

        <bean class="org.onebusaway.transit_data_federation.impl.realtime.gtfs_realtime.GtfsRealtimeSource">
        <property name="tripUpdatesUrl" value="http://gtfsrt.<%= node[:oba][:env] %>.dash.obaweb.org:8080/api/v1/key/612bek1/agency/71/command/gtfs-rt/tripUpdates" />
        <property name="vehiclePositionsUrl" value="http://gtfsrt.<%= node[:oba][:env] %>.dash.obaweb.org:8080/api/v1/key/612bek1/agency/71/command/gtfs-rt/vehiclePositions" />
        <property name="refreshInterval" value="30" />
        <property name="agencyIds">
            <list>
                <value>71</value>
            </list>
        </property>
        <property name="showNegativeScheduledArrivals" value="false"/>
    </bean>


      <bean class="org.onebusaway.transit_data_federation.impl.realtime.gtfs_realtime.GtfsRealtimeSource">
        <property name="tripUpdatesUrl" value="http://data.peaktransit.com/gtfsrt/45/TripUpdate.pb" />
        <property name="vehiclePositionsUrl" value="http://data.peaktransit.com/gtfsrt/45/VehiclePosition.pb" />
        <property name="refreshInterval" value="90" />
        <property name="maxDeltaLocationMeters" value="1000" />
        <property name="useLabelAsId" value="true" />
        <property name="agencyIds">
            <list>
                <value>45</value>
            </list>
        </property>
        <property name="showNegativeScheduledArrivals" value="false"/>
    </bean>

<!--
    <bean class="org.onebusaway.transit_data_federation.impl.realtime.gtfs_realtime.GtfsRealtimeSource">
    <property name="alertsUrl" value="http://admin.<%= node[:oba][:env] %>.wmata.obaweb.org:8080/api/alerts-from-rss/service-alerts" />

    <property name="refreshInterval" value="300" />
    <property name="agencyIds">
        <list>
                <value>1</value>
        </list>
        </property>
    </bean>
-->

    <bean id="httpServiceClient" class="org.onebusaway.transit_data_federation.util.HttpServiceClientImpl" >
      <constructor-arg type="java.lang.String" value="<%= node[:oba][:admin_server] %>"/>
      <constructor-arg type="java.lang.Integer" value="<%= node[:oba][:admin_server_port] %>" />
      <constructor-arg type="java.lang.String" value="/api/" />
    </bean>

    <bean id="bundleManagementService" class="org.onebusaway.transit_data_federation.impl.bundle.BundleManagementServiceImpl">
      <property name="bundleStoreRoot" value="${bundlePath}" />
      <property name="standaloneMode" value="false" />
    </bean>

    <bean id="refreshServiceImpl" class="org.onebusaway.container.refresh.RefreshServiceImpl" />
</beans>
